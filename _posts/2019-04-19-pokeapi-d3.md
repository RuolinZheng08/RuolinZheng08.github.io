---
layout: post
title: Making a Pokémon HP Chart with PokéAPI and D3
---

A Demo Project made with PokéAPI and D3. This chart displays Pokémons' Base HP Value. Click on the button to fetch a random Pokémon!

<style type='text/css'>
  .chart text {
    font: 10px sans-serif;
  }
  section {
    text-transform: capitalize;
  }
  div {
    margin-bottom: 5px;
  }
</style>
<script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3-scale-radial.js"></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js'></script>
<script src='https://d3js.org/d3.v5.min.js'></script>

<body>
  <div>
    <button onclick="getPokemon()">Click to add a random Pokémon</button>
  </div>
  <div>
    <img src='' id='pokeicon'>
    <section></section>
  </div>
  <div class='chart'></div>
</body>

<script type="text/javascript">
    const pokemons = [];
    getPokemon(25); // use Pikachu as a demo

    const margin = {top: 10, right: 10, bottom: 10, left: 10};
    const width = 440;
    const height = 440;
    const innerRadius = 80;
    const outerRadius = 220;

    const x = d3.scaleBand()
    .range([0, 2 * Math.PI]);

    const y = d3.scaleRadial()
    .domain([0, 200])
    .range([innerRadius, outerRadius]);

    const chart = d3.select('.chart')
    .append('svg')
    .attr('width', 460).attr('height', 460)
    .append('g').attr('transform', `translate(${width / 2}, ${height / 2})`);

    function updateIcon(idx, pokemon) {
      const url = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${idx}.png`;
      d3.select('#pokeicon').attr('src', url);
      d3.select('section')
      .html(`Added ${pokemon.name}!`);
    }

    function updateChart() {
      chart.selectAll('*').remove();
      x.domain(pokemons.map((d) => {return d.name;}));

      chart.append('g')
      .selectAll('path')
      .data(pokemons)
      .enter()
      .append('path')
      .style('fill', 'lightgreen ')
      .attr('d', d3.arc()
        .innerRadius(innerRadius)
        .outerRadius((d) => {return y(d.stats.hp);})
        .startAngle((d) => {return x(d.name);})
        .endAngle((d) => {return x(d.name) + x.bandwidth();})
        .padAngle(0.01)
        .padRadius(innerRadius));

      // add bars
      chart.append('g')
      .selectAll('path')
      .data(pokemons)
      .enter()
      .append('path')
      .style('fill', 'lightgreen ')
      .attr('d', d3.arc()
        .innerRadius(innerRadius)
        .outerRadius((d) => {return y(d.stats.hp);})
        .startAngle((d) => {return x(d.name);})
        .endAngle((d) => {return x(d.name) + x.bandwidth();})
        .padAngle(0.01)
        .padRadius(innerRadius));

      // add pokemon names
      chart.append('g')
      .selectAll('g')
      .data(pokemons)
      .enter()
      .append('g')
        .attr('transform', (d) => {
          return `rotate(${((x(d.name) + x.bandwidth() / 2) * 180 / Math.PI - 90)}) translate(150, 0)`;
        })
        .append('text')
        .text((d) => {return d.name;}) 
        .attr('transform', 'rotate(0)');

      // add hp number
      chart.append('g')
      .selectAll('g')
      .data(pokemons)
      .enter()
      .append('g')
        .attr('transform', (d) => {
          return `rotate(${((x(d.name) + x.bandwidth() / 2) * 180 / Math.PI - 90)}) translate(90, 0)`;
        })
        .append('text')
        .text((d) => {return d.stats.hp;}) 
        .attr('transform', 'rotate(0)');
    }

    function cleanData(data) {
      const stats = {};
      for (let i = 0; i < data.stats.length; i++) {
        const stat_name = data.stats[i].stat.name;
        stats[stat_name] = data.stats[i].base_stat;
      }
      return {
        name: data.name,
        stats: stats
      };
    }

    function getPokemon(idx) {
      if (idx === undefined) {
        idx = Math.floor(Math.random() * 492 + 1); // 493 pokemons up to Diamond & Pearl, 0 is invalid
      }
      const settings = {
        'crossDomain': true,
        'url': `http://pokeapi.co/api/v2/pokemon/${idx}`
      };
      $.ajax(settings).done((data) => {
        newPokemon = cleanData(data);
        pokemons.push(newPokemon);
        updateIcon(idx, newPokemon);
        updateChart();
      });
    }

  </script>